

<template>
  <img class="s-img" :src="defaultSrc" :data-src="currentSrc" :alt="alt" :height="!height ? '':(height + 'px')" />
</template>


<script>
/**
 *  <s-img :src="xxxx" />
 * @param src 图片路径
 * @param defaultSrc
 * @param width
 * @param height 
 * @param offset  延迟加载离还有多小像素开始加载
 * @param mode  裁剪模式
 * @param alt 
 * 
 * 
 * https://segmentfault.com/a/1190000008616597
 * 如果是先隐藏后显示的图片，需要调用一下 super:blazy-revalidate 事件
 */
import _ from "lodash";
import Blazy from "blazy";
import { isSupported, detectWebp } from "../libs/webp-support";
import uuidMixin from "../libs/mixin-uuid.js";
import Vue from "vue";

let SImg = {
  mixins: [uuidMixin],
  created() {
    this.$bus.$on("super:blazy-revalidate", this.revalidate);
  },
  mounted() {
    this.$el.setAttribute("id", `s-img-${this.uuid}`);

    this.$nextTick(() => {
      this.init();
    });
    detectWebp();
  },
  data() {
    return {
      srcs: {
        default:
          "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",
        course:
          "data:image/png;base64,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",
        teacher:
          "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOoAAAC0CAYAAACaELDJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM3NUJGODIxRUY5ODExRTc4NzI1QjBBQzZCMEJCMEQzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM3NUJGODIyRUY5ODExRTc4NzI1QjBBQzZCMEJCMEQzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Mzc1QkY4MUZFRjk4MTFFNzg3MjVCMEFDNkIwQkIwRDMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Mzc1QkY4MjBFRjk4MTFFNzg3MjVCMEFDNkIwQkIwRDMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4hYRU5AAACqElEQVR42uzZQWqTURiG0STVdAtqO1J3UB24ixRaV6EDHVi6AUE71VVUbd2HIjhuZ5YuQGkxVvC9egMxZFjsh5wDL4Twjz54SEiGZ+cXgyXG2aTvQXarvwdcrm/Zl+xTdpC9z6aLDw2XhLqZvczuuiH8c0fZTvZu/s3R3OuV7EV/QKRwNVp7b3uLK7M3r8098Dx75k5QwqzFnfmvvlvZvttAOdvZmxZq+5HoOFt3EyjnJLs96sWKFGpayx62UCduAaVNWqj33QFKu9dCveEOUNrNFuqqO0Bp45EbQH1CBaECQgWhAkIFhApCBYQKCBWECggVhAoIFRAqCBUQKiBUECogVECoIFRAqCBUQKiAUEGogFABoYJQAaGCUAGhAkIFoQJCBYQKQgWECggVhAoIFYQKCBUQKggVECogVBAqIFQQKiBUQKggVECogFBBqIBQAaGCUAGhglABoQJCBaECQgWECkIFhApCBYQKCBWECggVECoIFRAqIFQQKiBUECogVECoIFRAqIBQQaiAUEGogFABoYJQAaECQgWhAkIFhApCBYQKQgWECggVhAoIFRAqCBUQKggVECogVBAqIFRAqCBUQKiAUEGogFBBqIBQAaGCUAGhAkIFoQJCBaECQgWECkIFhAoIFYQKCBUQKggVECoIFRAqIFQQKiBUQKggVECoIFRAqIBQQaiAUAGhglABoQJCBaECQgWhAkIFhAr/a6hfnQFKm7ZQT90BSjttoX52ByjtQwv10B2gtMPh2fnFOC+Os3X3gHJOsjvtE3WaPXUPKOlJ9n3298x+tucmUMpeb/Ov/1F3s1duAyW87k0OFkP9mT3OtrIjd4Ir0drbzh71Jn9rPyYte3jcH97MNrK17LobwqX7Mfjzg9HH7KB/1Z0uPvRLgAEAewhB/xwgLXIAAAAASUVORK5CYII=",
        package:
          "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAADRCAYAAAAT3QCIAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo3NzFjMGNjNS04Mzc5LTQzZTUtOWY4MS02ZWJkZWUzOWZjYzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUQ5OTU3NThFRjk4MTFFNzkxMzRDNUFGQjUwMUIyREQiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUQ5OTU3NTdFRjk4MTFFNzkxMzRDNUFGQjUwMUIyREQiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6M2NjMzJhOGEtMzc4YS01ZTRiLTk5YzMtZmQ1NGQ5NDA4ODI0IiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YjdiNTRmMWEtMjdiZC0xMTdiLWEyMzUtOTVkYzQ5YzgxM2I3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+tZ55sQAABA5JREFUeNrs281JA1EUhuFJRqJ24N9KUoIu7GJcaCeaEkRLEZV0YgO6SzoQlICMZ+AGLhfdRK+r54GPyGRWZ/WCOur7vnn/+Gy+MYl1aWexg/QMAABKb7FF7Dk2T1uVL+3utM3ohwA9j93Fpm4JAMAGXmKz2FMZoOPixTZ2m14UnwAAbGpoycfUlm3+xVbx4k3syr0AAPgj1+lztn6Q/wr+InbvRgAAVDC05kP+N6DDPxe9xo7cBgCACpax4wjQ1TgrUvEJAEAth7HL4Yd1gHZuAgBAZV0eoKfuAQBAZSd5gO65BwAAle3nAbrtHgAAVDbJAxQAAP6FAAUAQIACACBAAQBAgAIAIEABAECAAgAgQAEAEKAAACBAAQAQoAAAIEABABCgAAAgQAEAEKAAAAhQAAAQoAAACFAAABCgAAAIUAAAEKAAAAhQAAAEKAAACFAAAAQoAAAIUAAABCgAAAIUAAAEKAAAAhQAAAQoAAACFAAABCgAAAIUAAABCgAAAhQAAAEKAAACFAAAAQoAAAIUAAABCgCAAAUAAAEKAIAABQAAAQoAgAAFAAABCgCAAAUAQIACAIAABQBAgAIAgAAFAECAAgAgQAEAQIACACBAAQBAgAIAIEABAECAAgAgQAEAEKAAACBAAQAQoAAAIEABABCgAAAgQAEAEKAAAAhQAAAQoAAACFAAABCgAAAIUAAABKgTAAAgQAEAEKAAACBAAQAQoAAAIEABABCgAAAIUAAAEKAAAAhQAAAQoAAACFAAABCgAAAIUAAABCgAAAhQAAAEKAAACFAAAAQoAAAIUAAABCgAAAIUAAAEKAAAAhQAAAQoAAACFAAAAQoAAAIUAAABCgAAAhQAAAEKAAACFAAAAQoAgAAFAAABCgCAAAUAAAEKAIAABQAAAQoAgAAFAECAAgCAAAUAQIACAIAABQBAgAIAgAAFAECAAgAgQAEAQIACACBAAQBAgAIAIEABABCgAAAgQAEAEKAAACBAAQAQoAAAIEABABCgAAAIUAAAEKAAAAhQAAAQoAAACFAAABCgAAAIUAAABCgAAAhQAAAEKAAACFAAAAQoAAACFAAABCgAAAIUAAAEKAAAAhQAAAQoAAACFAAAAQoAAAIUAAABCgAAAhQAAAEKAAACFAAAAQoAgAAFAAABCgCAAAUAAAEKAIAABQAAAQoAgAAFAECAAgCAAAUAQIACAIAABQBAgAIAIEABAECAAgAgQAEAQIACACBAAQBAgAIAIEABABCgAAAgQAEAEKAAACBAAQAQoAAAIEABABCgAAAIUAAAEKAAAAhQAAAQoAAACFAAABCgAAAIUAAABCgAAAhQAAAEKAAACFAAAAQoAAACFAAABCgAAAIUAAB+4UuAAQAXby5ilkMjfQAAAABJRU5ErkJggg==",
        packageBanner:
          "data:image/png;base64,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"
      }
    };
  },
  computed: {
    defaultSrc() {
      return this.srcs[this.defaultType];
    },
    currentSrc() {
      let src = this.src;
      if (src.indexOf("qiniu.myfriday.cn") > -1) {
        if (src.indexOf("?") > -1) {
          src = src.slice(0, src.indexOf("?"));
        }
        src += "?imageView2/" + this.mode;
        src += this.width ? `/w/${this.width}` : "";
        src += this.height ? `/h/${this.height}` : "";
        src += `/q/75${isSupported() ? "/format/webp" : ""}`;
      }

      return src;
    }
  },
  props: {
    src: {
      type: String
    },
    defaultType: {
      type: String,
      default: "default"
    },
    width: {
      type: Number,
      default: 0
    },
    height: {
      type: Number,
      default: 0
    },
    offset: {
      type: Number,
      default: 1
    },
    mode: {
      type: Number,
      default: 1
    },
    alt: String
  },
  watch: {
    src(val) {
      this.init();
    }
  },
  methods: {
    init() {
      const _this = this;
      this.blazy && this.blazy.destory();
      this.$el.src = this.defaultSrc;
      this.$el.setAttribute("data-src", this.currentSrc);
      this.$el.className = this.$el.className.replace("b-loaded", "");


      this.blazy = new Blazy({
        selector: `#s-img-${this.uuid}`,
        offset: this.offset,
        success(ele) {
          _this.$emit("on-success", _this.src, ele);
        },
        error(ele, msg) {
          _this.$emit("on-error", _this.src, ele, msg);
        }
      });
    },
    revalidate() {
      setTimeout(() => {
        this.blazy && this.blazy.revalidate();
      }, 100);
    }
  },
  beforeDestroy() {
    this.blazy && this.blazy.destroy();
    this.blazy = null;
    this.$bus.$off("super:blazy-revalidate", this.revalidate);
  }
};

export default SImg;
</script>

<style lang="postcss">
.b-lazy {
  transition: opacity 500ms ease-in-out;
  max-width: 100%;
  opacity: 0;
}
.b-lazy.b-loaded {
  opacity: 1;
}
</style>

